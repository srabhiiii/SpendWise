<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/dashboard.css">
    <title>SPENDWISE</title>
</head>
<body>
    
    <% const username=transactions[0].username%>
    <%- include("../includes/nav2.ejs",{username:username}) %>
    <div class="first">
    <h1 class="mainline ">Welcome <%= username %></h1>
    <h4 class="mainline" style="color: white;">Lets See Your Overall Transactions Details In SpendWise</h4>
</div>
    <% const expenses=transactions.reduce((sum,ele)=>{return ele.type==='Expense'?sum+=ele.amount:sum;},0);
       const income=transactions.reduce((sum,ele)=>{return ele.type==='income'?sum+=ele.amount:sum;},0);

       
      
       
    %>
    <br>
    
    <div class="container">
        <div class="incomebox box" >
            <p><strong>Total Income</strong></p>
            <p style="color: rgb(0, 255, 0); font-size: 150%;"><strong><%=income%></strong></p>
        </div>
        <div class="expensebox box" >
            <p><strong>Total Expenses</strong></p>
            <p style="color: rgb(255, 0, 0); font-size: 150%;"><strong><%=expenses%></strong></p>
        </div>
        <div class="balancebox box">
            <p><strong>Total Savings</strong></p>
            <p style="font-size: 150%;color:aliceblue"><strong><%=income-expenses%></strong></p>
        </div>
    </div>
    <div class="history">
    
    <table class="table table-striped table-hover table-dark" style="  border-color:rgb(92, 0, 179);text-align: center;">
        
        <thead >
            <tr >
                <th colspan="2" style= "background-color:rgb(92, 0, 179);color: rgb(250, 248, 251);">Top Expense Categories</th>
            </tr>
            <%if(top3expense.length!=0){%>
            <tr>
                <th style= "color:rgb(92, 0, 179);background-color: rgb(250, 248, 251);">Category</th>
                <th style= "color:rgb(92, 0, 179);background-color: rgb(250, 248, 251);">Total Amount Spent</th>
            </tr>
            <% } else { %>
                <th style= "color:rgb(92, 0, 179);background-color: rgb(32, 31, 33);">No Expenses</th>
            <%}%>
        </thead>
        <tbody>
            <%if(top3expense.length!=0){%>
            <% for(transaction of top3expense) {%>
                <tr>
                    <td><%= transaction._id %></td>
                    <td><%= transaction.totalamount %></td>
                </tr>

            <%} }%>
            
        </tbody>
        
      </table>
      
      <table class="table table-striped table-hover table-dark" style="border-color:blueviolet;text-align: center;">
       
        <thead style="background-color: rgb(0, 0, 0);">
            <tr>
                <th colspan="2" style= "background-color:rgb(92, 0, 179);color: rgb(250, 248, 251);">Top Income Categories</th>
            </tr>
            <%if(top3income.length!=0){%>
            <tr>
                
                <th style= "color:rgb(92, 0, 179);background-color: rgb(250, 248, 251);">Category</th>
                <th style= "color:rgb(92, 0, 179);background-color: rgb(250, 248, 251);">Total Amount Spent</th>
            </tr>
            <% } else { %>
                <th style= "color:rgb(92, 0, 179);background-color: rgb(32, 31, 33);">No Expenses</th>
            <%}%>
        </thead>
        <tbody>
            <%if(top3income.length!=0){%>
            <% for(transaction of top3income) {%>
                <tr>
                    <td><%= transaction._id %></td>
                    <td><%= transaction.totalamount %></td>
                </tr>

            <%}}%>
        </tbody>
        
      </table>
    </div>
      
    
    
</body>
</html>